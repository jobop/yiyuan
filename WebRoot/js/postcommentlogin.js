function isDigit(b){var a=/^[0-9]{6}$/;if(!a.exec(b)){return false}return true}function ckEmail(a){var b=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;if(b.test(a)){return true}return false}function ckPasswd(b){var a=/^[^ \f\n\r\t\v]{6,16}$/;if(!a.exec(b)){return false}return true}function ckMobile(b){var a=/^1\d{10}$/;if(!a.exec(b)){return false}else{return true}}function SetCookie(a,b){document.cookie=a+"="+escape(b)+";id=1ypg;path=/;domain="+$domain}function SetCookieByExpires(b,d,a){var c=a;var e=new Date();e.setTime(e.getTime()+c*24*60*60*1000);document.cookie=b+"="+escape(d)+";id=1ypg;path=/;expires="+e.toGMTString()+";domain="+$domain}function getCookie(b){var a=document.cookie.match(new RegExp("(^| )"+b+"=([^;]*)(;|$)"));if(a!=null){return unescape(a[2])}return null}function loadingLogin(){$("#btnSubmitLogin").remove();$("#loginSubmitStatus").show()}$(function(){var a=$("#username");var j=$("#pwd");var e=$("#name_ts");var l=$("#pwd_ts");var f=$("#shareId").val();var d=null;var g=null;var k=function(n,m){$("#liError").html('<div id="div_login"><p class="ts"></p>'+n+"</div>");$(m).focus()};var c=getCookie("loginUser");if(c!=null){a.val(c);j.focus().attr("class","text_name_focus")}else{a.focus().attr("class","text_name_focus")}a.focus(function(){$(this).attr("class","text_name_focus");if(e.attr("class")=="ts"){e.attr("class","ts").html("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7/\u90ae\u7bb1")}$(this).parent().attr("class","click")}).blur(function(){$(this).attr("class","num");$(this).parent().attr("class","");i(false,false)});j.focus(function(){$(this).attr("class","text_name_focus");if(l.attr("class")=="ts"){l.attr("class","ts").html("\u8bf7\u586b\u5199\u957f\u5ea6\u4e3a6-20\u957f\u5ea6\u7684\u5b57\u7b26\u5bc6\u7801")}$(this).parent().attr("class","click")}).blur(function(){$(this).attr("class","num");$(this).parent().attr("class","");i(false,false)});var i=function(p,m){var n=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;var o=/^1[3-9]\d{9}$/;d=a.val();g=j.val();e.attr("class","ts").html("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7/\u90ae\u7bb1");l.attr("class","ts").html("\u8bf7\u586b\u5199\u957f\u5ea6\u4e3a6-20\u957f\u5ea6\u7684\u5b57\u7b26\u5bc6\u7801");if(d==""){if(p){a.focus()}j.attr("class","num");if(m){e.attr("class","wrong").html("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7/\u90ae\u7bb1\uff01")}return false}else{if(!ckMobile(d)&&!ckEmail(d)){if(p){a.focus()}j.attr("class","num");e.attr("class","wrong").html("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7/\u90ae\u7bb1\uff01");return false}}if(g==""){if(p){j.focus()}a.attr("class","num");if(m){l.attr("class","wrong").html("\u8bf7\u8f93\u5165\u767b\u5f55\u5bc6\u7801\uff01")}return false}else{if(!ckPasswd(g)){if(p){j.focus()}a.attr("class","num");l.attr("class","wrong").html("\u767b\u5f55\u5bc6\u7801\u4e3a6-20\u957f\u5ea6\u7684\u5b57\u7b26\uff01");return false}}return true};var h="";var b=function(n){if(!isLoaded){return}var o=false;var m=false;if(n==0){o=true;m=true}if(n==1){o=true;m=false}if(i(o,m)){if(h!=d){$.ajax({url:"/login/login.html",data:"userName="+d+"&pwd="+g,beforeSend:loadingLogin,success:function(p){if(p=="userError"){a.focus();e.attr("class","wrong").html("\u767B\u5F55\u5E10\u53F7\u4E0D\u5B58\u5728\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\uFF01");$("#loginSubmitStatus").before('<input id="btnSubmitLogin" type="button" name="login_init" value="\u767b\u5f55" class="login_init"/>');$("#loginSubmitStatus").hide();h=d}else{if(p=="pwdError"){j.focus();l.attr("class","wrong").html("\u767B\u5F55\u5BC6\u7801\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\uFF01");$("#loginSubmitStatus").before('<input id="btnSubmitLogin" type="button" name="login_init" value="\u767b\u5f55" class="login_init"/>');$("#loginSubmitStatus").hide()}else{if(p.userId){SetCookie("userId",p.userId);SetCookie("face",p.faceImg)}if(p.userName){SetCookie("userName",p.userName)}else{if(p.mail){SetCookie("userName",p.mail)}else{if(p.phone){SetCookie("userName",p.phone)}}}SetCookie("loginType",0);parent.location.href=$www+"/shareShow/"+f+".html"}}SetCookieByExpires("loginUser",d,365)},error:function(){alert("\u8FDE\u63A5\u670D\u52A1\u5668\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01");window.location.href=$www}})}else{e.attr("class","wrong").html("\u767B\u5F55\u5E10\u53F7\u4E0D\u5B58\u5728\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\uFF01");a.focus()}}};$("#LoginForm").keydown(function(m){var n=(window.event)?event.keyCode:m.keyCode;if(n==32){return false}else{if(n==13){b(1)}}return true});$("#btnSubmitLogin").live("click",function(){b(0)});isLoaded=true;QC.Login({btnId:"qqLoginBtn",scope:"get_user_info,add_share",size:"B_M"},function(m,n){if(QC.Login.check()){QC.Login.getMe(function(p,o){$.ajax({url:"/register/authorizeIsExists.action",type:"POST",data:"openId="+encodeURIComponent(p.replace(/(\/)/g,"")),success:function(q){if(q=="true"){$.ajax({type:"POST",url:"/register/authorizeRegsiter.action",data:"userName="+encodeURIComponent(m.nickname.replace(/(\/)/g,""))+"&openId="+p+"&userFace="+m.figureurl_2,success:function(r){SetCookie("userId",r.userId);SetCookie("userName",r.userName);SetCookie("face",r.faceImg);SetCookie("loginType",2);parent.location.href=$www+"/shareShow/"+f+".html"}})}else{SetCookie("userId",q.userId);SetCookie("userName",q.userName);SetCookie("face",q.faceImg);SetCookie("loginType",2);parent.location.href=$www+"/shareShow/"+f+".html"}}})})}})});
